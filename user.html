<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>แผนที่งานไหมขอนแก่น</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
  html, body { margin:0; padding:0; height:100%; }
  #map { width:100%; height:100vh; }
</style>
</head>
<body>
<div id="map"></div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyDGYuI3yxJbUTc6T_0pm6WiEKZul11tXS0",
  authDomain: "suchartwork-1487382986748.firebaseapp.com",
  databaseURL: "https://suchartwork-1487382986748.firebaseio.com",
  projectId: "suchartwork-1487382986748",
  storageBucket: "suchartwork-1487382986748.firebasestorage.app",
  messagingSenderId: "353884592527",
  appId: "1:353884592527:web:bcdb9b337a6fff8feb13fa"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const map = L.map('map').setView([16.4419, 102.8350], 17);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom:19 }).addTo(map);

const colors = { "ร้านค้า":"red", "โซนกิจกรรม":"orange", "ซุ้มหน่วยงาน":"blue", "สุขา":"green", "พยาบาล":"pink", "ความปลอดภัย":"purple" };

const locRef = ref(db, "khonkaenfair/locations");
onValue(locRef, snap => {
  snap.forEach(c => {
    const d = c.val();
    const color = colors[d.category] || "gray";
    const marker = L.circleMarker([d.lat, d.lng], {
      radius: 8,
      color: color,
      fillColor: color,
      fillOpacity: 0.9,
      weight: 2
    }).addTo(map);
    const navUrl = `https://www.google.com/maps/dir/?api=1&destination=${d.lat},${d.lng}`;
    marker.bindPopup(`<b>${d.name}</b><br>${d.category}<br>${d.detail}<br><a href="${navUrl}" target="_blank">นำทาง</a>`);
  });
});
</script>
</body>
</html>
