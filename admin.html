<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin - ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏á‡∏≤‡∏ô‡πÑ‡∏´‡∏°‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    body { margin: 0; font-family: sans-serif; background: #f5f5f5; }
    #map { height: 70vh; }
    form { padding: 10px; background: #fff; box-shadow: 0 0 8px #ccc; margin: 10px; border-radius: 8px; }
    input, select, textarea, button { width: 100%; margin: 5px 0; padding: 8px; font-size: 14px; }
    button { background: #007bff; color: white; border: none; border-radius: 6px; cursor: pointer; }
    button:hover { background: #0056b3; }
    ul { list-style: none; padding: 0; margin: 10px; }
    li { background: #fff; margin-bottom: 5px; padding: 8px; border-radius: 6px; box-shadow: 0 0 5px #ccc; }
    #logout { background: #dc3545; margin: 10px; }
    #logout:hover { background: #b52a37; }
  </style>
</head>
<body>
  <script>
    // üîí ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
    if (localStorage.getItem("adminLogin") !== "true") {
      window.location.href = "login.html";
    }
  </script>

  <h2 style="text-align:center;">üó∫Ô∏è Admin - ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏á‡∏≤‡∏ô‡πÑ‡∏´‡∏°‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô</h2>
  <button id="logout">üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>

  <form id="placeForm">
    <input id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà" required>
    <select id="category" required>
      <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà --</option>
      <option>‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</option>
      <option>‡πÇ‡∏ã‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</option>
      <option>‡∏ã‡∏∏‡πâ‡∏°‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</option>
      <option>‡∏™‡∏∏‡∏Ç‡∏≤</option>
      <option>‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•</option>
      <option>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</option>
    </select>
    <textarea id="detail" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"></textarea>
    <input id="lat" placeholder="‡∏•‡∏∞‡∏ï‡∏¥‡∏à‡∏π‡∏î" readonly>
    <input id="lng" placeholder="‡∏•‡∏≠‡∏á‡∏à‡∏¥‡∏à‡∏π‡∏î" readonly>
    <button type="submit">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏¥‡∏Å‡∏±‡∏î</button>
  </form>

  <div id="map"></div>

  <h3 style="text-align:center;">üìç ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏°‡∏∏‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
  <ul id="markerList"></ul>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-database.js";

    // ‚úÖ Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyDGYuI3yxJbUTc6T_0pm6WiEKZul11tXS0",
      authDomain: "suchartwork-1487382986748.firebaseapp.com",
      databaseURL: "https://suchartwork-1487382986748.firebaseio.com",
      projectId: "suchartwork-1487382986748",
      storageBucket: "suchartwork-1487382986748.firebasestorage.app",
      messagingSenderId: "353884592527",
      appId: "1:353884592527:web:bcdb9b337a6fff8feb13fa"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const map = L.map('map').setView([16.4322, 102.8236], 17);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);

    let marker = L.marker([16.4322, 102.8236], { draggable: true }).addTo(map);
    document.getElementById('lat').value = marker.getLatLng().lat;
    document.getElementById('lng').value = marker.getLatLng().lng;

    marker.on('dragend', () => {
      const pos = marker.getLatLng();
      document.getElementById('lat').value = pos.lat.toFixed(6);
      document.getElementById('lng').value = pos.lng.toFixed(6);
    });

    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(pos => {
        const lat = pos.coords.latitude, lng = pos.coords.longitude;
        marker.setLatLng([lat, lng]);
        map.setView([lat, lng], 17);
        document.getElementById('lat').value = lat;
        document.getElementById('lng').value = lng;
      });
    }

    const form = document.getElementById('placeForm');
    form.addEventListener('submit', e => {
      e.preventDefault();
      const data = {
        name: name.value,
        category: category.value,
        detail: detail.value,
        lat: parseFloat(lat.value),
        lng: parseFloat(lng.value)
      };
      push(ref(db, "places"), data);
      alert("‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
      form.reset();
    });

    const list = document.getElementById('markerList');
    onValue(ref(db, "places"), snapshot => {
      list.innerHTML = "";
      snapshot.forEach(item => {
        const key = item.key;
        const val = item.val();
        const li = document.createElement('li');
        li.innerHTML = `<b>${val.name}</b> (${val.category})
          <br><button data-key="${key}" style="color:red;">üóëÔ∏è ‡∏•‡∏ö</button>`;
        list.appendChild(li);
      });
    });

    list.addEventListener('click', e => {
      if (e.target.tagName === 'BUTTON') {
        const key = e.target.dataset.key;
        remove(ref(db, "places/" + key));
        alert("üóëÔ∏è ‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
      }
    });

    // ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
    document.getElementById("logout").addEventListener("click", () => {
      localStorage.removeItem("adminLogin");
      window.location.href = "login.html";
    });
  </script>
</body>
</html>
